<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Marketing Jeopardy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Google Sans', 'Roboto', sans-serif;
            background-color: #F1F3F4;
            color: #3c4043;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .card {
            background-color: #FFFFFF;
            border-radius: 1rem;
            border: 1px solid #DADCE0;
            padding: 0.75rem;
            box-shadow: 0 1px 2px 0 rgba(60,64,67,0.302), 0 2px 6px 2px rgba(60,64,67,0.149);
        }

        .team-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem; 
        }
        
        .question-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.5rem;
        }

        .question-number {
            background-color: #E8EAED;
            color: #3c4043;
            text-align: center;
            padding: 0.5rem;
            border-radius: 1rem;
            font-size: 1.25rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
            aspect-ratio: 1 / 1;
            /* Animation properties */
            opacity: 0;
            transform: scale(0.5);
            animation: pop-in 0.5s ease-out forwards;
        }
        
        .question-number.answered {
            background-color: #F8F9FA;
            color: #BDBDBD;
            cursor: not-allowed;
            text-decoration: line-through;
        }
        
        .question-number:hover:not(.answered) {
            background-color: #DADCE0;
        }
        
        /* Keyframe Animations */
        @keyframes pop-in {
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes content-fade-in {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes score-increase-anim {
            0% { transform: scale(1); }
            50% { transform: scale(1.4); color: #10B981; } /* Bright Green */
            100% { transform: scale(1); }
        }

        @keyframes score-decrease-anim {
            0% { transform: scale(1); }
            50% { transform: scale(1.4); color: #EF4444; } /* Bright Red */
            100% { transform: scale(1); }
        }

        .content-fade-in {
            animation: content-fade-in 0.4s ease-out;
        }

        .score-increase {
            animation: score-increase-anim 0.6s ease-in-out;
        }
        
        .score-decrease {
            animation: score-decrease-anim 0.6s ease-in-out;
        }
        
        .btn-press {
             transition: transform 0.1s ease, filter 0.1s ease;
        }

        .btn-press:active {
            transform: scale(0.95);
            filter: brightness(0.9);
        }

    </style>
</head>
<body class="p-2 flex items-center justify-center min-h-screen">

    <main class="w-full max-w-5xl h-full mx-auto grid grid-cols-1 lg:grid-cols-6 gap-2">
        
        <div id="teamsContainer" class="col-span-1 space-y-2 flex flex-col">
            <!-- Team cards will be dynamically generated here -->
        </div>

        <div class="lg:col-span-4 flex flex-col gap-2">
            <div id="clueDisplayCard" class="card flex-grow flex flex-col items-center justify-center text-center p-4 min-h-[250px]">
                <!-- Game content will be dynamically generated here -->
            </div>
            <div id="questionGrid" class="question-grid">
                <!-- Question buttons will be dynamically generated here -->
            </div>
        </div>

        <div class="col-span-1 space-y-2 flex flex-col">
            <div class="card text-center flex-grow">
                <h3 class="text-base font-medium text-gray-500 mb-1">Current Team</h3>
                <p id="currentTeamDisplay" class="text-2xl font-bold text-blue-600">-</p>
            </div>
            <div class="card text-center flex-grow">
                <h3 class="text-base font-medium text-gray-500 mb-1">Time Left</h3>
                <p id="timerDisplay" class="text-5xl font-bold text-red-600">00</p>
            </div>
            <div id="endGameButton" class="card text-center flex-grow flex items-center justify-center cursor-pointer hover:bg-red-100 transition-colors btn-press">
                <h3 class="text-lg font-bold text-red-600">End Game</h3>
            </div>
        </div>

    </main>

    <!-- Audio elements for sound effects -->
    <audio id="clueSound" src="tone.mp3" preload="auto"></audio>
    <audio id="backgroundMusic" src="background.mp3" preload="auto" loop></audio>
    <audio id="rightSound" src="right.mp3" preload="auto"></audio>
    <audio id="wrongSound" src="wrong.mp3" preload="auto"></audio>
    <audio id="bonusSound" src="bonus.mp3" preload="auto"></audio>

<script>
    // --- GAME STATE ---
    let gameStarted = false;
    let currentTeamIndex = 0;
    let answeredQuestions = [];
    let teamScores = {};
    let timerInterval = null;
    let answeredBonusQuestions = [];
    let activeBonusIndex = null;
    let lastClickedQuestionId = null;
    
    // --- STATIC DATA ---
    const teams = [
        { name: 'Performance Patriots', logoUrl: 'https://kapildoesmarketing.github.io/familyfeud/1.png' },
        { name: 'Impression Invaders', logoUrl: 'https://kapildoesmarketing.github.io/familyfeud/2.png' },
        { name: 'Xtreme Optimizers', logoUrl: 'https://kapildoesmarketing.github.io/familyfeud/3.png' },
        { name: 'Engagement Experts', logoUrl: 'https://kapildoesmarketing.github.io/familyfeud/5.png' },
        { name: 'Lead Legends', logoUrl: 'https://kapildoesmarketing.github.io/familyfeud/4.png' }
    ];

    const bonusQuestions = [
        { teamIndex: 0, clue: "According to a survey conducted by GWI, in India, x% of YouTube Shorts users don't use Instagram Reels", options: ["24%", "34%", "44%", "54%"], answer: "44%" },
        { teamIndex: 1, clue: "Google and/or YouTube are present in x% of the journeys where consumers said they discovered a new brand , product or retailer", options: ["67%", "77%", "87%", "97%"], answer: "87%" },
        { teamIndex: 2, clue: "x% of shoppers looked for shopping ideas on Google.", options: ["81%", "71%", "61%", "51%"], answer: "81%" },
        { teamIndex: 3, clue: "According to a survey conducted by Kantar, in the past month, x% of Indian consumers claimed to have used YouTube, compared to 45% for Jiocinema + Hotstar and 3% for Amazon Prime.", options: ["60%", "70%", "80%", "90%"], answer: "80%" },
        { teamIndex: 4, clue: "On average YouTube Ads drove an uplift on 'Purchase Intent' x times greater than Social Platform Ads across all Kantar Context Lab Studies in India.", options: ["1.2x", "1.5x", "2.0x", "2.5x"], answer: "1.2x" }
    ];
    
    const jeopardyQuestions = [
        { id: 1, clue: "This feature can supercharge the performance of Search Ads and has shown a 27% increase in conversions for activated campaigns.", response: "What is AI Max for Search?" },
        { id: 2, clue: "Merchants using this new Demand Gen feature have seen an average 11% increase in conversion value by seamlessly adding products to a user's cart on their website.", response: "What are Checkout Links?" },
        { id: 3, clue: "Powered by Google AI, this feature helps campaigns capture additional valuable conversions by tapping into more diverse search sources.", response: "What is Smart Bidding Exploration?" },
        { id: 4, clue: "This new Performance Max feature provides channel-level breakdowns of performance, helping advertisers optimize their campaigns.", response: "What is Channel Performance Reporting?" },
        { id: 5, clue: "Now offering increased visibility within Performance Max, this report allows you to find customer queries and make informed optimizations.", response: "What is the Search terms report?" },
        { id: 6, clue: "This is Google owned inventory is now available on Demand Gen", response: "What is Maps?" },
        { id: 7, clue: "Interactive shopping experience, powered by the Google Merchant Center, that lets viewers discover and engage with products directly from the big screen.", response: "What is Shoppable CTV" },
        { id: 8, clue: "Most prominent placement, is now shoppable on Mobile", response: "What is Shoppable MH" },
        { id: 9, clue: "This is new Search product / feature expands what AI Overviews can do, with more advanced reasoning and multimodality", response: "What is AI mode?" },
        { id: 10, clue: "This feature on Search OR the keywordless targeting technology of Performance Max OR AI Max in Search (beta) will be the best way to leverage ads in AI Overviews.", response: "What is broad match?" },
        { id: 11, clue: "This feature is now available in Demand Gen campaigns which was earlier available in Pmax, Search & Shopping", response: "What is NCA?" },
        { id: 12, clue: "With this updated new platform, you can deepen existing connections, find new ones and integrate authentic creator content into your ad strategies", response: "What is creator partnerships hub?" },
        { id: 13, clue: "This new feature / tool helps you analyze cross-channel performance and determine where to adjust budgets or invest incremental media dollars, directly in Google Analytics.", response: "What is Cross-Channel Budgeting Tool ?" },
        { id: 14, clue: "This tagging solution for advertisers enhances conversion data accuracy by routing it through your websiteâ€™s own server, improving bidding, campaign optimization, and ROAS.", response: "What is Google tag gateway?" },
        { id: 15, clue: "This new NCA feature expands on existing capabilities of the new customer acquisition goal to not only optimize to the acquisition of new customers, but specifically optimize towards ones who are not yet searching for or engaging with your Brand", response: "Prospecting Mode in NCA" },
    ];

    // --- DOM ELEMENTS CACHING---
    const teamsContainer = document.getElementById('teamsContainer');
    const questionGrid = document.getElementById('questionGrid');
    const clueDisplayCard = document.getElementById('clueDisplayCard');
    const currentTeamDisplay = document.getElementById('currentTeamDisplay');
    const timerDisplay = document.getElementById('timerDisplay');
    const endGameButton = document.getElementById('endGameButton');
    const clueSound = document.getElementById('clueSound');
    const backgroundMusic = document.getElementById('backgroundMusic');
    const rightSound = document.getElementById('rightSound');
    const wrongSound = document.getElementById('wrongSound');
    const bonusSound = document.getElementById('bonusSound');

    // --- UTILITY FUNCTIONS ---
    function playAudio(audioElement) {
        audioElement.currentTime = 0;
        audioElement.play().catch(error => console.error(`Audio playback failed: ${error}`));
    }
    
    function updateClueDisplay(newHtml) {
        clueDisplayCard.classList.remove('content-fade-in');
        void clueDisplayCard.offsetWidth; // Trigger a reflow to restart the animation
        clueDisplayCard.innerHTML = newHtml;
        clueDisplayCard.classList.add('content-fade-in');
    }

    // --- RENDER FUNCTIONS ---
    function renderGame() {
        renderTeams();
        renderCenterColumn();
    }

    function renderTeams() {
        teamsContainer.innerHTML = '';
        teams.forEach((team, index) => {
            const teamCard = document.createElement('div');
            const isActive = index === currentTeamIndex && gameStarted;
            const bonusAnswered = answeredBonusQuestions.includes(index);
            teamCard.className = `card p-2 transition-all duration-300 ${isActive ? 'ring-4 ring-blue-400' : ''}`;
            teamCard.innerHTML = `
                <div class="flex items-center gap-2 w-full">
                    <img src="${team.logoUrl}" alt="${team.name} Logo" class="w-8 h-8 object-contain ${bonusAnswered ? 'cursor-not-allowed opacity-50' : 'cursor-pointer'}" onerror="this.src='https://placehold.co/40x40/E8EAED/3c4043?text=G'" onclick="triggerBonusRound(${index})">
                    <div class="flex-grow">
                        <p class="text-sm font-bold">${team.name}</p>
                        <p class="score-display-${index} text-xl font-bold text-green-600 transition-colors duration-300">${teamScores[team.name] || 0}</p>
                    </div>
                </div>
                <div class="flex items-center justify-end gap-1 mt-1 w-full">
                    <button class="w-6 h-6 flex items-center justify-center rounded-full bg-green-100 text-green-700 hover:bg-green-200 transition-colors text-base font-bold btn-press" onclick="manualAdjustScore(${index}, 5)" aria-label="Add 5 points to ${team.name}" title="Add 5 points">+</button>
                    <button class="w-6 h-6 flex items-center justify-center rounded-full bg-red-100 text-red-700 hover:bg-red-200 transition-colors text-base font-bold btn-press" onclick="manualAdjustScore(${index}, -5)" aria-label="Subtract 5 points from ${team.name}" title="Subtract 5 points">-</button>
                </div>
            `;
            teamsContainer.appendChild(teamCard);
        });
    }

    function renderCenterColumn() {
        if (!gameStarted) {
            const welcomeHTML = `
                <h2 class="text-3xl font-bold">Google Marketing Jeopardy</h2>
                <p class="text-lg text-gray-500 mt-2">Get ready to test your knowledge.</p>
                <button id="startGameBtn" class="mt-4 bg-blue-600 text-white font-bold py-2 px-6 rounded-full text-base shadow-lg hover:bg-blue-700 transition-transform transform hover:scale-105 btn-press">
                    Start Game
                </button>
            `;
            updateClueDisplay(welcomeHTML);
            questionGrid.innerHTML = '';
            currentTeamDisplay.textContent = '-';
            document.getElementById('startGameBtn').addEventListener('click', startGame);
        } else {
            currentTeamDisplay.textContent = teams[currentTeamIndex].name;
            renderQuestionGrid();
        }
    }

    function renderQuestionGrid() {
        questionGrid.innerHTML = '';
        for (let i = 1; i <= 15; i++) {
            const questionDiv = document.createElement('div');
            questionDiv.className = `question-number ${answeredQuestions.includes(i) ? 'answered' : ''}`;
            questionDiv.textContent = i;
            questionDiv.dataset.questionId = i;
            questionDiv.style.animationDelay = `${(i - 1) * 0.03}s`; // Staggered animation
            if (!answeredQuestions.includes(i)) {
                questionDiv.addEventListener('click', selectQuestion);
            }
            questionGrid.appendChild(questionDiv);
        }
    }
    
    // --- GAME LOGIC ---
    function startGame() {
        gameStarted = true;
        currentTeamIndex = 0;
        answeredQuestions = [];
        answeredBonusQuestions = [];
        activeBonusIndex = null;
        teamScores = teams.reduce((acc, team) => ({ ...acc, [team.name]: 0 }), {});
        updateClueDisplay(`<h2 class="text-2xl font-medium text-gray-600">Select a question to begin.</h2>`);
        
        backgroundMusic.volume = 0.3;
        playAudio(backgroundMusic);

        renderGame();
    }

    function selectQuestion(event) {
        const questionId = parseInt(event.target.dataset.questionId);
        lastClickedQuestionId = questionId; // Store the current question's ID
        if (answeredQuestions.includes(questionId)) return;
        
        playAudio(clueSound);
        answeredQuestions.push(questionId);
        const question = jeopardyQuestions.find(q => q.id === questionId);
        
        if (question) {
            const clueHTML = `
                <div class="flex-grow flex items-center justify-center">
                    <p class="text-2xl font-light p-2">${question.clue}</p>
                </div>
                <div class="flex space-x-2 mt-2">
                    <button class="btn-press font-bold py-2 px-4 rounded-full shadow-md transition-transform transform hover:scale-105 bg-green-500 text-white text-sm" onclick="handleAnswer(true)">Right</button>
                    <button class="btn-press font-bold py-2 px-4 rounded-full shadow-md transition-transform transform hover:scale-105 bg-red-500 text-white text-sm" onclick="handleAnswer(false)">Wrong</button>
                </div>
            `;
            updateClueDisplay(clueHTML);
            startTimer(30);
        }
        renderQuestionGrid();
    }

    window.handleAnswer = (isCorrect) => {
        stopTimer();
        if (isCorrect) {
            playAudio(rightSound);
            adjustScore(currentTeamIndex, 10);
            const question = jeopardyQuestions.find(q => q.id === lastClickedQuestionId);
            const teamName = teams[currentTeamIndex].name;
            const answer = question ? question.response : 'the correct answer';

            const wellDoneHTML = `
                <div class="flex-grow flex items-center justify-center flex-col text-center p-4">
                    <h2 class="text-2xl font-bold text-green-600">Well Done, ${teamName}!</h2>
                    <p class="text-xl mt-2">The correct answer is:</p>
                    <p class="text-2xl font-bold mt-1">${answer}</p>
                    <button class="btn-press mt-6 font-bold py-2 px-6 rounded-full shadow-md transition-transform transform hover:scale-105 bg-blue-600 text-white text-base" onclick="nextTurn()">Continue</button>
                </div>
            `;
            updateClueDisplay(wellDoneHTML);
        } else {
            playAudio(wrongSound);
            enterStealMode();
        }
    }

    function enterStealMode() {
        const stealHTML = `
            <div class="flex-grow flex items-center justify-center flex-col">
                <p class="text-2xl font-bold text-yellow-500">STEAL!</p>
                <p class="text-lg text-gray-600 mt-2">Which team is stealing?</p>
            </div>
            <div class="flex space-x-2 mt-2 flex-wrap justify-center">
                ${teams.map((team, index) => {
                    if (index === currentTeamIndex) return '';
                    return `<button class="btn-press rounded-full w-14 h-14 flex items-center justify-center border-4 border-transparent hover:border-yellow-400 transition-all" onclick="selectStealingTeam(${index})">
                                <img src="${team.logoUrl}" class="w-12 h-12 rounded-full object-cover" onerror="this.src='https://placehold.co/48x48/E8EAED/3c4043?text=G'">
                            </button>`;
                }).join('')}
            </div>
            <button class="btn-press font-bold py-2 px-4 rounded-full shadow-md transition-transform transform hover:scale-105 bg-gray-500 text-white mt-2 text-sm" onclick="noSteal()">No Steal</button>
        `;
        updateClueDisplay(stealHTML);
    }
    
    window.selectStealingTeam = (teamIndex) => {
        const stealAttemptHTML = `
             <div class="flex-grow flex items-center justify-center flex-col">
                <p class="text-2xl font-bold">Steal attempt by:</p>
                <p class="text-xl font-bold text-blue-600 mt-2">${teams[teamIndex].name}</p>
            </div>
            <div class="flex space-x-2 mt-2">
                <button class="btn-press font-bold py-2 px-4 rounded-full shadow-md transition-transform transform hover:scale-105 bg-green-500 text-white text-sm" onclick="handleStealAnswer(${teamIndex}, true)">Right (+5)</button>
                <button class="btn-press font-bold py-2 px-4 rounded-full shadow-md transition-transform transform hover:scale-105 bg-red-500 text-white text-sm" onclick="handleStealAnswer(${teamIndex}, false)">Wrong (-5)</button>
            </div>
        `;
        updateClueDisplay(stealAttemptHTML);
        startTimer(15, true);
    }

    window.noSteal = () => {
        stopTimer();
        const question = jeopardyQuestions.find(q => q.id === lastClickedQuestionId);
        const answer = question ? question.response : 'the correct answer';

        const answerRevealHTML = `
            <div class="flex-grow flex items-center justify-center flex-col text-center p-4">
                <h2 class="text-2xl font-bold text-yellow-600">No Steal!</h2>
                <p class="text-xl mt-2">The correct answer was:</p>
                <p class="text-2xl font-bold mt-1">${answer}</p>
                <button class="btn-press mt-6 font-bold py-2 px-6 rounded-full shadow-md transition-transform transform hover:scale-105 bg-blue-600 text-white text-base" onclick="nextTurn()">Continue</button>
            </div>
        `;
        updateClueDisplay(answerRevealHTML);
    }
    
    window.handleStealAnswer = (teamIndex, isCorrect) => {
        stopTimer();
        if (teamIndex !== null) {
            playAudio(isCorrect ? rightSound : wrongSound);
            adjustScore(teamIndex, isCorrect ? 5 : -5);
        }
        
        const question = jeopardyQuestions.find(q => q.id === lastClickedQuestionId);
        const answer = question ? question.response : 'the correct answer';

        if (isCorrect) {
            const teamName = teams[teamIndex].name;
            const wellDoneHTML = `
                <div class="flex-grow flex items-center justify-center flex-col text-center p-4">
                    <h2 class="text-2xl font-bold text-green-600">Well Done, ${teamName}! (Steal)</h2>
                    <p class="text-xl mt-2">The correct answer is:</p>
                    <p class="text-2xl font-bold mt-1">${answer}</p>
                    <button class="btn-press mt-6 font-bold py-2 px-6 rounded-full shadow-md transition-transform transform hover:scale-105 bg-blue-600 text-white text-base" onclick="nextTurn()">Continue</button>
                </div>
            `;
            updateClueDisplay(wellDoneHTML);
        } else {
            const wrongAnswerHTML = `
                <div class="flex-grow flex items-center justify-center flex-col text-center p-4">
                    <h2 class="text-2xl font-bold text-red-600">Incorrect!</h2>
                    <p class="text-xl mt-2">The correct answer was:</p>
                    <p class="text-2xl font-bold mt-1">${answer}</p>
                    <button class="btn-press mt-6 font-bold py-2 px-6 rounded-full shadow-md transition-transform transform hover:scale-105 bg-blue-600 text-white text-base" onclick="nextTurn()">Continue</button>
                </div>
            `;
            updateClueDisplay(wrongAnswerHTML);
        }
    }

    window.manualAdjustScore = (teamIndex, points) => {
        adjustScore(teamIndex, points);
    }

    function adjustScore(teamIndex, points) {
        const teamName = teams[teamIndex].name;
        teamScores[teamName] += points;
        renderTeams(); // Re-render to update the score text

        // Find the score element and apply animation
        const scoreElement = document.querySelector(`.score-display-${teamIndex}`);
        if(scoreElement) {
            const animationClass = points > 0 ? 'score-increase' : 'score-decrease';
            scoreElement.classList.add(animationClass);
            setTimeout(() => {
                scoreElement.classList.remove(animationClass);
            }, 600); // Duration of the animation
        }
    }

    window.nextTurn = () => {
        if (answeredQuestions.length === jeopardyQuestions.length) {
            endGame();
            return;
        }
        currentTeamIndex = (currentTeamIndex + 1) % teams.length;
        updateClueDisplay(`<h2 class="text-2xl font-medium text-gray-600">${teams[currentTeamIndex].name}, select a question.</h2>`);
        renderGame();
    }
    
    // --- BONUS ROUND LOGIC ---
    window.triggerBonusRound = (logoIndex) => {
        if (answeredBonusQuestions.includes(logoIndex) || !gameStarted) return;
        stopTimer();
        playAudio(bonusSound);
        activeBonusIndex = logoIndex;
        const bonusQuestion = bonusQuestions.find(q => q.teamIndex === logoIndex);

        const bonusHTML = `
            <div class="flex-grow flex items-center justify-center flex-col">
                <p class="text-2xl font-bold text-purple-600">BONUS QUESTION!</p>
                <p class="text-xl font-light mt-2 text-center p-2">${bonusQuestion.clue}</p>
            </div>
            <div class="grid grid-cols-2 gap-2 mt-4 w-full max-w-md">
                ${bonusQuestion.options.map(option => `
                    <button class="btn-press font-bold py-3 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105 bg-white text-gray-800 border border-gray-300 text-sm" onclick="handleBonusOptionSelect('${option}')">${option}</button>
                `).join('')}
            </div>
             <button class="btn-press font-bold py-2 px-4 rounded-full shadow-md transition-transform transform hover:scale-105 bg-gray-500 text-white mt-4 text-sm" onclick="cancelBonusRound()">Cancel Bonus</button>
        `;
        updateClueDisplay(bonusHTML);
    }

    window.handleBonusOptionSelect = (selectedOption) => {
        const bonusQuestion = bonusQuestions.find(q => q.teamIndex === activeBonusIndex);
        const isCorrect = selectedOption === bonusQuestion.answer;
        
        let resultHTML;
        if (isCorrect) {
            playAudio(rightSound);
            resultHTML = `<h2 class="text-2xl font-bold text-green-600">Correct!</h2>`;
        } else {
            playAudio(wrongSound);
            resultHTML = `
                <h2 class="text-2xl font-bold text-red-600">Incorrect!</h2>
                <p class="text-xl mt-2">The correct answer was: <span class="font-bold">${bonusQuestion.answer}</span></p>
            `;
        }

        const teamSelectionHTML = `
            <div class="flex-grow flex items-center justify-center flex-col text-center p-4">
                ${resultHTML}
                <p class="text-lg text-gray-600 mt-4">Which team attempted the bonus?</p>
                <div class="flex space-x-2 mt-2 flex-wrap justify-center">
                    ${teams.map((team, index) => {
                        return `<button class="btn-press rounded-full w-14 h-14 flex items-center justify-center border-4 border-transparent hover:border-purple-400 transition-all" onclick="assignBonusPoints(${index}, ${isCorrect})">
                                    <img src="${team.logoUrl}" class="w-12 h-12 rounded-full object-cover" onerror="this.src='https://placehold.co/48x48/E8EAED/3c4043?text=G'" title="${team.name}">
                                </button>`;
                    }).join('')}
                </div>
                <button class="btn-press font-bold py-2 px-4 rounded-full shadow-md transition-transform transform hover:scale-105 bg-gray-500 text-white mt-4 text-sm" onclick="finishBonusRound(false)">Nobody Answered</button>
            </div>
        `;
        updateClueDisplay(teamSelectionHTML);
    }

    window.assignBonusPoints = (teamIndex, isCorrect) => {
        if (activeBonusIndex === null) return;
        adjustScore(teamIndex, isCorrect ? 5 : -5);
        finishBonusRound(true);
    }

    window.finishBonusRound = (wasAttempted) => {
        if (activeBonusIndex !== null) {
            answeredBonusQuestions.push(activeBonusIndex);
            activeBonusIndex = null;
        }
        renderTeams(); // Re-render to update logo clickability
        updateClueDisplay(`
            <div class="flex-grow flex items-center justify-center flex-col text-center p-4">
                <h2 class="text-2xl font-medium text-gray-600">Bonus round complete!</h2>
                <p class="text-lg mt-2">Returning to ${teams[currentTeamIndex].name}'s turn.</p>
                <button class="btn-press mt-6 font-bold py-2 px-6 rounded-full shadow-md transition-transform transform hover:scale-105 bg-blue-600 text-white text-base" onclick="resumeNormalPlay()">Continue</button>
            </div>
        `);
    }

    window.resumeNormalPlay = () => {
        updateClueDisplay(`<h2 class="text-2xl font-medium text-gray-600">${teams[currentTeamIndex].name}, select a question.</h2>`);
    }

    window.cancelBonusRound = () => {
        activeBonusIndex = null;
        updateClueDisplay(`<h2 class="text-2xl font-medium text-gray-600">Bonus round canceled. It's ${teams[currentTeamIndex].name}'s turn.</h2>`);
    }

    function endGame() {
        stopTimer();
        gameStarted = false;
        questionGrid.innerHTML = '';
        backgroundMusic.pause();

        let highestScore = -Infinity;
        let winners = [];
        for (const teamName in teamScores) {
            if (teamScores[teamName] > highestScore) {
                highestScore = teamScores[teamName];
                winners = [teamName];
            } else if (teamScores[teamName] === highestScore) {
                winners.push(teamName);
            }
        }

        let winnerMessage;
        if (winners.length > 1) {
            winnerMessage = `It's a tie between ${winners.join(' & ')}!`;
        } else if (winners.length === 1 && teamScores[winners[0]] > 0) {
            winnerMessage = `${winners[0]} wins the game!`;
        } else {
             winnerMessage = "Good game, everyone!";
        }

        const endGameHTML = `
            <h2 class="text-3xl font-bold">Game Over!</h2>
            <p class="text-xl text-blue-600 mt-2">${winnerMessage}</p>
            <p class="text-lg text-gray-500 mt-2">Final Score: ${highestScore}</p>
            <button id="playAgainBtn" class="btn-press mt-4 bg-blue-600 text-white font-bold py-2 px-6 rounded-full text-base shadow-lg hover:bg-blue-700 transition-transform transform hover:scale-105">
                Play Again
            </button>
        `;
        updateClueDisplay(endGameHTML);
        currentTeamDisplay.textContent = 'Finished';
        document.getElementById('playAgainBtn').addEventListener('click', startGame);
    }

    // --- TIMER FUNCTIONS ---
    function startTimer(duration, isSteal = false) {
        clearInterval(timerInterval);
        let timeLeft = duration;
        timerDisplay.textContent = String(timeLeft).padStart(2, '0');
        timerInterval = setInterval(() => {
            timeLeft--;
            timerDisplay.textContent = String(timeLeft).padStart(2, '0');
            if (timeLeft <= 0) {
                stopTimer();
                if (isSteal) {
                    // If steal timer runs out, it's an incorrect answer
                    handleStealAnswer(null, false); 
                } else {
                   // If main timer runs out, go to steal mode
                   playAudio(wrongSound);
                   enterStealMode();
                }
            }
        }, 1000);
    }

    function stopTimer() {
        clearInterval(timerInterval);
        timerDisplay.textContent = "00";
    }

    // --- INITIALIZATION ---
    endGameButton.addEventListener('click', endGame);
    window.onload = renderGame;
</script>
</body>
</html>
